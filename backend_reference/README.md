# Backend Reference Documentation

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç **–∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Backend API** –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ CyberHub.

### –§–∞–π–ª—ã:
- **`index.ts`** - –ü–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ backend —Å–µ—Ä–≤–µ—Ä–∞
- **`database.ts`** - –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
- **`API_REFERENCE.md`** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö endpoints

---

## ‚ö° –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ **–í–°–ï–ì–î–ê –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–∏ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º Frontend –∫–æ–¥–∞**

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã React, —Ç—ã –û–ë–Ø–ó–ê–ù:
1. –û—Ç–∫—Ä—ã—Ç—å `/backend_reference/index.ts`
2. –ù–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π endpoint
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç
   - –ö–∞–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
   - –ö–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è (Authorization?)
   - –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å

### 2Ô∏è‚É£ **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç –≤ Backend - —Å–Ω–∞—á–∞–ª–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –µ—ë**

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ `index.ts`:

**–®–ê–ì 1:** –û–±–Ω–æ–≤–∏—Ç—å `/backend_reference/index.ts`
```typescript
app.get("/api/new-feature", requireSession, async (req, res) => {
  // ... —Ç–≤–æ–π –Ω–æ–≤—ã–π endpoint
});
```

**–®–ê–ì 2:** –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ - –æ–±–Ω–æ–≤–∏—Ç—å `/backend_reference/database.ts`
```typescript
await db.exec(`
  CREATE TABLE IF NOT EXISTS new_table (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    ...
  );
`)
```

**–®–ê–ì 3:** –û–±–Ω–æ–≤–∏—Ç—å `/backend_reference/API_REFERENCE.md`

**–®–ê–ì 4:** –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø–∏—Å–∞—Ç—å Frontend –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–æ–≤—ã–µ endpoints

### 3Ô∏è‚É£ **–°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

Frontend –î–û–õ–ñ–ï–ù —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å Backend:

‚ùå **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**
```typescript
// Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { success: true, items: [...] }
const data = await fetch('/api/items');
const items = data.data; // –û—à–∏–±–∫–∞! –î–æ–ª–∂–Ω–æ –±—ã—Ç—å data.items
```

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û:**
```typescript
const data = await fetch('/api/items');
const items = data.items; // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç backend
```

### 4Ô∏è‚É£ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π**

–ï—Å–ª–∏ –º–µ–Ω—è–µ—à—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –≤ backend:
```typescript
// –ë—ã–ª–æ: prize_name
// –°—Ç–∞–ª–æ: prize_title
```

–¢–æ –û–ë–Ø–ó–ê–ù –æ–±–Ω–æ–≤–∏—Ç—å –í–°–ï –º–µ—Å—Ç–∞ –≤–æ Frontend –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ç–æ –ø–æ–ª–µ:
- API types (`src/types/api.ts`)
- Components mapping
- API calls

### 5Ô∏è‚É£ **–ù–µ –ª–æ–º–∞–π SmartShell**

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
–§—É–Ω–∫—Ü–∏–∏ `gqlRequest`, `getServiceToken`, `getClientBalance`, `calculateProgressSafe` - **–ù–ï –¢–†–û–ì–ê–¢–¨!**

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç –±–∞–ª–∞–Ω—Å –∏ –¥–µ–ø–æ–∑–∏—Ç—ã —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π SmartShell.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –õ–æ–≥–∏–Ω —á–µ—Ä–µ–∑ SmartShell API
- –°–æ–∑–¥–∞–µ—Ç—Å—è session token (UUID)
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`

### üí∞ –ë–∞–ª–∞–Ω—Å
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å SmartShell
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ TopBar
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ claim –¥–µ–Ω–µ–≥

### üìä –ü—Ä–æ–≥—Ä–µ—Å—Å (Daily/Monthly)
- –°—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–ª–∞—Ç–µ–∂–µ–π –≤ SmartShell
- –¢–æ–ª—å–∫–æ DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –†–∏–≥–∏ (`Europe/Riga`)
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–µ–π—Å–æ–≤

### üé∞ –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–æ–≤
1. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é —Ä—É–ª–µ—Ç–∫–∏ (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
2. Backend –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç winner (weighted random)
3. Winner –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤:
   - `spins` (–¥–ª—è Live Feed)
   - `inventory` (–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞)
   - `case_claims` (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ daily/monthly)
4. Frontend –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç winner

### üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
**3 —Ç–∏–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:**
- `skin` - CS2 —Å–∫–∏–Ω (—Ç—Ä–µ–±—É–µ—Ç Trade Link –¥–ª—è claim)
- `physical` - –§–∏–∑–∏—á–µ—Å–∫–∏–π —Ç–æ–≤–∞—Ä (—Ç—Ä–µ–±—É–µ—Ç Trade Link –¥–ª—è claim)
- `money` - –î–µ–Ω—å–≥–∏ (–∞–≤—Ç–æ–≤—ã–≤–æ–¥ –Ω–∞ SmartShell –±–∞–ª–∞–Ω—Å)

**–°—Ç–∞—Ç—É—Å—ã:**
- `available` - –º–æ–∂–Ω–æ claim/sell
- `processing` - –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞
- `received` - –ø–æ–ª—É—á–µ–Ω–æ
- `sold` - –ø—Ä–æ–¥–∞–Ω–æ

### üìã –°–∏—Å—Ç–µ–º–∞ –∑–∞—è–≤–æ–∫ (Requests)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "Claim" –Ω–∞ —Å–∫–∏–Ω–µ/—Ñ–∏–∑ —Ç–æ–≤–∞—Ä–µ
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ Trade Link
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞—è–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `requests`
4. –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É –≤ –∞–¥–º–∏–Ω–∫–µ
5. –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç: approve/deny/return

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ Backend

- **Framework:** Express.js
- **Database:** SQLite3 (—á–µ—Ä–µ–∑ `sqlite` wrapper)
- **External API:** SmartShell GraphQL API
- **Auth:** Session-based (UUID tokens)
- **Timezone:** Europe/Riga (EET/EEST)

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞

- [ ] –ü—Ä–æ—á–∏—Ç–∞–ª `/backend_reference/index.ts`
- [ ] –ù–∞—à–µ–ª –Ω—É–∂–Ω—ã–π endpoint
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É response
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª required –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- [ ] –ï—Å–ª–∏ endpoint –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª –Ω–æ–≤—ã–π
- [ ] –û–±–Ω–æ–≤–∏–ª API_REFERENCE.md
- [ ] –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤–æ Frontend —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Backend
- [ ] –ù–µ —Å–ª–æ–º–∞–ª SmartShell –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

---

## üö® –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "drops is not defined"
```typescript
// Backend:
res.json({ success: true, drops: [...] })

// Frontend (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
const items = data.spins; // –û—à–∏–±–∫–∞!

// Frontend (–ü–†–ê–í–ò–õ–¨–ù–û):
const items = data.drops;
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "Authorization required"
```typescript
// –ó–∞–±—ã–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:
fetch('/api/profile') // 401 Unauthorized

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
fetch('/api/profile', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
})
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "Item not available"
```typescript
// –ü—ã—Ç–∞–µ–º—Å—è claim –ø—Ä–µ–¥–º–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º != 'available'
// –ü—Ä–æ–≤–µ—Ä—è–π status –ø–µ—Ä–µ–¥ claim!

if (item.status === 'available') {
  claimItem(item.id);
}
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ Backend:
1. –û–ø–∏—à–∏ —á—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
2. –Ø –æ–±–Ω–æ–≤–ª—é `/backend_reference/` —Ñ–∞–π–ª—ã
3. –ü–æ—Ç–æ–º –Ω–∞–ø–∏—à—É Frontend –∫–æ–¥

**–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:**
> "–î–æ–±–∞–≤—å endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ XP"

**–ú–æ–π –æ—Ç–≤–µ—Ç:**
1. –û–±–Ω–æ–≤–ª—é `index.ts` —Å –Ω–æ–≤—ã–º endpoint
2. –û–±–Ω–æ–≤–ª—é `API_REFERENCE.md`
3. –°–æ–∑–¥–∞–º Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
